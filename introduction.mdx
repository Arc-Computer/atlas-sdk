# Atlas SDK Autodiscovery

Atlas now supports a Codex-style onboarding flow for self-managed, stateful agents.
You can go from installation to a working `atlas run` session in three commands:

```bash
pip install arc-atlas
atlas env init
atlas run --task "Investigate the incident summary"
```

`atlas env init` scans your project for `@atlas.environment` and
`@atlas.agent` classes, runs a discovery loop to understand how they
interact, and persists the results under `.atlas/`. Subsequent calls to
`atlas run` read the cached metadata, verify that the module hashes are
still valid, and replay the same control loop while capturing telemetry
for learning evaluation. When the selected classes need constructor
arguments, the CLI now synthesises lightweight factories via Gemini 2.5 Flash
or Claude Haiku 4.5, stores them in `.atlas/generated_factories.py`, and defers
side effects until you rerun with `--validate`.
Discovery records the preferred runtime mode (`capabilities.preferred_mode`)
and pins the orchestrator to it (`orchestration.forced_mode`) so Atlas routes
straight to `auto` or `paired` execution without manual configuration. When
factories signal missing prerequisites, the CLI marks the run for auto-skip,
sets `ATLAS_DISCOVERY_VALIDATE=0`, and surfaces the preflight guidance in
`.atlas/discover.json`.

The generated files include:

- `.atlas/generated_factories.py` – auto-generated factories for constructor
  arguments that are discovered via the LLM synthesiser.
- `.atlas/discover.json` – module hashes, inferred handshake, schema hints,
  telemetry samples, and reward observations from discovery.
- `.atlas/generated_config.yaml` – a stub runtime profile pointing to the
  discovered environment and agent.
- `.atlas/runs/` – JSON artefacts storing telemetry and reward traces for
  each `atlas run` execution.

If you change your environment or agent implementation, re-run
`atlas env init` to refresh the cached metadata before calling
`atlas run` again. The [Stateful Agent Quickstart](docs/sdk/quickstart.mdx)
walks through the full onboarding flow and highlights how to validate the
generated factories.
